<html>
  <head>
    <title>Toastboard&mdash;The Breader Breadboard</title>
    <link href="main.css" rel="stylesheet" type="text/css">
    <link href="bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="bootstrap-theme.min.css" rel="stylesheet" type="text/css">
    <link rel="icon" href="/favicon.ico">
    <script type="text/javascript" src="d3.v3.min.js"></script>
    <script type="text/javascript" src="jquery-1.12.2.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>

<script type="text/javascript" src="toastboard.js/drawboard.js"></script>
<script type="text/javascript" src="toastboard.js/component.js"></script>
<script type="text/javascript" src="toastboard.js/graph.js"></script>

<body>
<div class="navbar navbar-inverse navbar-fixed-top">
  <div class="container"><div class="navbar-header"><a href="index.html" class="navbar-brand">Toastboard</a>
  <ul class="nav navbar-nav">
    <li><a href="led.html">Components</a></li>
  </ul>
  </div></div>
</div>
<div class="container" style="height:50px" />
<div class="container theme-showcase">
  <div class="jumbotron">
    <div class="row">
    <div class="col-xs-6">
    
    <div class="controls" style="margin: 15px">
    <button type="button" class="btn btn-secondary" id="scanOnce">Scan once</button>
    <button type="button" class="btn btn-secondary" id="scanCon">Scan continuously</button>
    <button type="button" class="btn btn-secondary" id="stopScan">Stop scan</button>
    <form class="form-inline" id="graphForm">
    <div class="form-group">
    <div class="input-group">
      <div class="input-group-addon">Row</div>
      <input type="text" class="form-control" id="rowToGraph" placeholder="Number">
      <select class="form-control" id="sideToGraph">
        <option>Left</option>
        <option>Right</option>
      </select>
      </div>
      </div>
      <button type="submit" class="btn btn-secondary">Graph row</button>
    </form>
    </div>

<div id="breadboard">
  <svg width="500" height="300" id="board" />

</div>
  <div id="clearButtonDiv"></div>
<div id="timestamp"></div> 
</div>
<div class="col-xs-6">

  <div class="rightside">
  
        <div id="selected-row"></div>


     
    <div id="graph-div">
      <svg width="500" height="300" id="graphviz"></svg>
    </div>
    
  </div>
</div>
</div>
</div>

<script type="text/javascript">
var socket = io.connect(); 

var getTimeStampString = function() {
  var now = new Date();
  var date = [ now.getMonth() + 1, now.getDate(), now.getFullYear() ];
  var time = [ now.getHours(), now.getMinutes(), now.getSeconds() ];
  return date.join("/") + " " + time.join(":")
};

var fullRowToRowAndSide = function(row) {
  var r;
  var s;
  if (row < 24) {
    r = row + 1;
    s = "Left";
  } else {
    r = row - 23;
    s = "Right";
  }
  return [r,s];
};

var myBreadboard = new Breadboard();
var myGraph = new Graph();

// if we get an "info" emit from the socket server then console.log the data we receive
socket.on('info', function (data) {
  console.log("got data from websocket inside html page");
  console.log(data);
  var json = JSON.parse(data);
  console.log(json);
  if (json.oscillo) {
    var rands = fullRowToRowAndSide(json.oscillo.row);
    $("#graphviz").html("");
    myGraph.addData(json.oscillo);
    $("#selected-row").html("<p>Selected row " + rands[0] + " " + rands[1] + "<\p>");
    myGraph.drawGraph();
  } else if (json.rowsLeft) {
    myBreadboard.drawBreadboard(json);
    var timestring = getTimeStampString();
    $("#timestamp").html("<p><i>last synched " + timestring + "</i></p>");
  }

});

var flipButtonStatus = function() {
  $("#scanOnce").toggle();
  $("#scanCon").toggle();
  $("#stopScan").toggle();
  $("#oscillo").toggle();
  $("#graphForm").toggle();
};

  $(document).ready(function() {
    // draw buttons nicely
    
    var getDataButton = document.getElementById("scanOnce");
    getDataButton.id = "scanOnce";
    getDataButton.innerHTML = "Scan once";
    getDataButton.className = "btn btn-secondary";
    getDataButton.addEventListener("click", function() {
      console.log("client asks for data");
      socket.emit("d","hello");
    });

    var continuousButton = document.getElementById("scanCon");
    continuousButton.id = "scanCon";
    continuousButton.innerHTML = "Scan continuously";
    continuousButton.className = "btn btn-secondary";
    continuousButton.addEventListener("click", function() {
      console.log("client asks for continuous scan");
      socket.emit("s","hello");
      flipButtonStatus();
    });

    var stopButton = document.getElementById("stopScan");
    stopButton.id = "stopScan";
    stopButton.innerHTML = "Stop scan";
    stopButton.className = "btn btn-secondary";
    stopButton.addEventListener("click", function() {
      console.log("client says stop scan");
      socket.emit("t","data");
      flipButtonStatus();
    });

    var clearBoardButton = document.createElement("button");
    clearBoardButton.innerHTML = "Clear Board";
    clearBoardButton.className = "btn btn-secondary";
    clearBoardButton.addEventListener("click", function() {
      myBreadboard.drawEmptyBreadboard();
    });

    $("#graphForm").submit(function(e) {
      e.preventDefault();
      var row = $("input#rowToGraph").val();
      var side = $("#sideToGraph").val();
      var rowString = "";
      row -= 1;
      if (side == "Right") {
        row +=24;
      }
      if (row < 10) {
        rowString = "0" + row;
      } else {
        rowString = "" + row;
      }
      console.log("graph row " + rowString + " on side " + side);
      flipButtonStatus();
      myGraph.clear();
      socket.emit("o",rowString);
    });

    var controlsDiv = document.getElementsByClassName("controls")[0];
    controlsDiv.appendChild(getDataButton);
    controlsDiv.appendChild(continuousButton);
    controlsDiv.appendChild(stopButton);

    var belowBoardDiv = document.getElementById("clearButtonDiv");
    belowBoardDiv.appendChild(clearBoardButton);

    $("#stopScan").toggle();

  var fakeJson = "{\"rowsLeft\":[3.3,\"f\",2.9,\"f\",\"f\",\"f\",\"f\",2.4,\"f\",\"f\",2.1,\"f\",\"f\",1.8,\"f\",\"f\",\"f\",\"f\",\"f\",\"f\",\"f\",\"f\",\"f\",\"f\"], \"rowsRight\":[\"f\",1.5,\"f\",\"f\",1.2,\"f\",0.7,\"f\",\"f\",\"f\",0.5,\"f\",\"f\",0.3,\"f\",\"f\",0.0,\"f\",\"f\",\"f\",\"f\",\"f\",\"f\",\"f\"]}";
  myBreadboard.drawBreadboard(JSON.parse(fakeJson));
/*
  var a = ['{"oscillo": { "data": [0.2], "time": [4] }}',
   '{"oscillo": { "data": [0.2], "time": [5 ]}}',
   '{"oscillo": { "data": [0.25], "time": [6]}}',
   '{"oscillo": { "data": [0.2], "time": [8 ]}}',
   '{"oscillo": { "data": [0.7], "time": [9 ]}}',
   '{"oscillo": { "data": [0.7], "time": [12] }}',
   '{"oscillo": { "data": [0.7], "time": [14] }}',
   '{"oscillo": { "data": [0.8], "time": [15] }}',
   '{"oscillo": { "data": [0.7], "time": [16] }}',
   '{"oscillo": { "data": [0.7], "time": [18] }}',
   '{"oscillo": { "data": [0.5], "time": [19] }}',
   '{"oscillo": { "data": [0.9], "time": [21] }}',
   '{"oscillo": { "data": [1.0], "time": [22] }}',
   '{"oscillo": { "data": [1.0], "time": [25] }}',
   '{"oscillo": { "data": [1.0], "time": [26] }}',
   '{"oscillo": { "data": [1.2], "time": [27] }}',
   '{"oscillo": { "data": [1.1], "time": [30] }}',
   '{"oscillo": { "data": [1.2], "time": [31] }}',
   '{"oscillo": { "data": [1.5], "time": [32] }}',
   '{"oscillo": { "data": [2.0], "time": [33] }}',
   '{"oscillo": { "data": [2.0], "time": [35] }}',
   '{"oscillo": { "data": [1.8], "time": [36] }}',
   '{"oscillo": { "data": [1.8], "time": [37] }}',
   '{"oscillo": { "data": [1.0], "time": [38] }}',
   '{"oscillo": { "data": [0.7], "time": [39] }}',
   '{"oscillo": { "data": [0.5], "time": [40] }}'];

   a.forEach(function(d) {
    var j = JSON.parse(d);
    myGraph.addData(j.oscillo);
   });
   console.log("fake graph info");
   console.log(myGraph.voltageData);
   myGraph.drawGraph();
*/


  });
</script>

</body>
</html>